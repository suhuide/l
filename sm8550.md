[memo.md](memo.md)

# [Fastboot](./files/fastboot.sh)
```c
source build/envsetup.sh;lunch qssi-userdebug;./build.sh -j12 dist --qssi_only
```
```c
fastboot flash vendor_boot vendor_boot.img
fastboot flash init_boot init_boot.img
fastboot flash boot boot.img
fastboot flash dtbo dtbo.img
```
```c
cd out/target/product/qssi
adb reboot fastboot
fastboot flash system system.img
fastboot flash system_ext system_ext.img
fastboot flash product product.img
fastboot flash vbmeta_system vbmeta_system.img
```
Build and replace Bluetooth.apk
```c
cd ./LA.QSSI.14.0.r1/LINUX/android
source build/envsetup.sh;lunch qssi-userdebug;make Bluetooth
source build/envsetup.sh;lunch qssi-userdebug;make out/target/product/qssi/system/app/Bluetooth/Bluetooth.apk

//Find and replace the apk on the phone
odin2:/ # find -name Bluetooth.apk 2>/dev/null
./system/app/Bluetooth/Bluetooth.apk

cd out/target/product/qssi/system/app/Bluetooth/
adb disable-verity&&adb reboot
adb root&&adb remount
adb push Bluetooth.apk /system/app/Bluetooth/
```
# prop
[qcom-prop.md](qcom-prop.md)

# TD1
## Docker(Skip it)
```c
$ docker exec -it S08G-A_thundercomm bash
登录成功后，切换用户到turbox
$ su turbox
```

## Code
[TD1 code](http://10.5.103.101:5080/rjb/ls_rjb_doc/-/blob/main/70_%E7%BC%96%E8%AF%91%E9%9B%86%E6%88%90/S08G-A%E5%90%8C%E6%AD%A5%E4%BB%A3%E7%A0%81_chef5.md)   

```c
cd ${workspace}
mkdir -p sm8550 && cd sm8550

repo init -u ssh://gerrit/lens/manifest -b S08G-A -m android13_qcm8550_s08g-a.xml --repo-url=ssh://gerrit/lens/git_repo --no-repo-verify -c

repo sync -j8 -c
```

## Link
Link LA.QSSI.13.0 and LE.UM.6.3.3 to vendor.  
```c
$ cd vendor
$ ln -sf ../qssi/LA.QSSI.13.0 ./LA.QSSI.13.0 && ln -sf ../le/LE.UM.6.3.3 ./LE.UM.6.3.3
```
## Build
```c
$ ./turbox_build.sh -a -l -v userdebug 

$ ./turbox_build.sh -u -v userdebug 
```
```c
source build/envsetup.sh;lunch kalama-userdebug;RECOMPILE_KERNEL=1 ./kernel_platform/build/android/prepare_vendor.sh kalama consolidate
make -j8 bootimage vendorbootimage dtboimage
bash build.sh -j16 dist --target_only
```
```c
meld
```
## Pack
### Flat_build
```c
$ ./turbox_build.sh --zip_flat_build -l -v userdebug
```
### Fastboot_build
```c
$ ./turbox_build.sh --zip_fastboot_build -l -v userdebug
```

## Flash
xbl_s_devprg_ns.melf

## Commit
```c
git push clo_le HEAD:refs/for/android13/qcm8550/s08g-a
git push clo_qssi HEAD:refs/for/android13/qcm8550/s08g-a
git push clo_vendor HEAD:refs/for/android13/qcm8550/s08g-a
```
## DTS
```c
/LA.VENDOR.13.2.6/LINUX/android/kernel_platform/msm-kernel/arch/arm64/boot/dts
vendor -> ../../../../../qcom/proprietary/devicetree
```
```c
repo forall -p -c git checkout backup/android13/qcm8550/s08g-a_20241227
repo forall "Turbox_C8550/release/KERNEL.PLATFORM.2.0/kernel_platform/qcom/proprietary" -c 'echo $REPO_PATH'

/data/sm8550/vendor/LA.VENDOR.13.2.6/LINUX/android/vendor/qcom/opensource/wlan/platform/cnss2/power.c
```
## GPIO
### LCD
#### 9711
|   Name       |  Pin |  name in code |
|    ----      | ---- | ---- |
|MP2DP_VCC33_E|GPIO_19|tl9711_pw_gpio|
|MIPI2DP_RST|GPIO_46|platform-reset-gpio|
|LCD_VCC_EN|GPIO_91|dp-pw-gpio|
|USB_HUB_EN|GPIO_64|tl9711-hub-3v3|
|OLED_BIAS_FD|GPIO_116|dp-pw-gpio|

```c
/data/sm8550/vendor/LA.VENDOR.13.2.6/LINUX/android/kernel_platform/qcom/proprietary/devicetree/qcom/kalama-qrd.dtsi 

/data/sm8550/vendor/LA.VENDOR.13.2.6/LINUX/android/vendor/qcom/proprietary/display-devicetree/display/dsi-panel-edp-ext-bridge-1080p-dsi0.dtsi
/data/sm8550/vendor/LA.VENDOR.13.2.6/LINUX/android/vendor/qcom/proprietary/display-devicetree/display/kalama-sde-display-common.dtsi
/data/sm8550/vendor/LA.VENDOR.13.2.6/LINUX/android/vendor/qcom/proprietary/display-devicetree/display/kalama-sde-display-qrd.dtsi
/data/sm8550/vendor/LA.VENDOR.13.2.6/LINUX/android/vendor/qcom/proprietary/display-devicetree/display/dsi-panel-ili9881d-720p-video.dtsi
```
```c
/data/sm8550/vendor/LA.VENDOR.13.2.6/LINUX/android/vendor/qcom/opensource/display-drivers/msm/dsi/dsi_panel.c 
/data/sm8550/vendor/LA.VENDOR.13.2.6/LINUX/android/vendor/qcom/opensource/display-drivers/msm/dsi/dsi_panel.h
```
28203: [TASK_9120] GPIO15拉高 | http://10.5.103.101:8010/c/qcom/sm8550/+/28203  
30782: [TASK_9773] S08G-A 新主板注册PCIE之前先把GPIO154拉高 | http://10.5.103.101:8010/c/qcom/sm8550/+/30782  
30936: [TASK_9810]BOOT阶段拉高GPIO154 | http://10.5.103.101:8010/c/qcom/sm8550/+/30936  

#### Buildin
```c
//r2005 to r2007
/data/sm8550/vendor/LA.VENDOR.13.2.6/LINUX/android/kernel_platform/common/arch/arm64/configs/gki_defconfig
CONFIG_DRM_LT9711=y
```
```c
/data/sm8550/vendor/LA.VENDOR.13.2.6/LINUX/android/kernel_platform/common/drivers/gpu/drm/bridge/lt9711.c
```

## Debug
```c
kalama:/ $ uname -srm
Linux 5.15.119-qki-consolidate-android13-8-g0da43388cd6c-dirty aarch64
```
```c
find -name '*.dts*' | xargs grep -rnw -e '&tlmm 13' -e 'gpio13'
find -name '*.dts*' | xargs grep -rnw -e '&tlmm 13' -e 'gpio13' 2>/dev/null
```
```c
cat /proc/comline
dmesg
cat /sys/kernel/debug/dmesg
```
```c
cat /proc/sys/kernel/printk
echo "0 6 1 7" > /proc/sys/kernel/printk
echo "4 6 1 7" > /proc/sys/kernel/printk
echo "6 6 1 7" > /proc/sys/kernel/printk
```

```c
[   17.614736][  T664] [drm:dsi_panel_parse_gpios [msm_drm]] *ERROR* [msm-dsi-error]: [ext video mode dsi bridge] tl9711-pw-gpio is not set, rc=0
[   17.628154][  T664] [drm:dsi_panel_parse_gpios [msm_drm]] *ERROR* [msm-dsi-error]: [ext video mode dsi bridge] qcom,dp-pw-gpio is not set, rc=0
```
```c
dsi_panel: dsi_panel@0 {  
    compatible = "example,panel";  
    
    pw-gpios = <&gpio0 10 GPIO_ACTIVE_HIGH>;  // tl9711-pw-gpio  
    dp-gpios = <&gpio0 11 GPIO_ACTIVE_HIGH>;  // qcom,dp-pw-gpio  

    ...  
}; 
```
## Startup

Start from
```c
Format: Log Type - Time(microsec) - Message - Optional Info
```
Kernel compeled
```c
Freeing initrd memory:
```
Init thread
```c
init    : starting service
```
Zygote service
```c
init    : starting service 'zygote'
init    : starting service 'zygote_secondary'...
```

```c
//查看log，是vendor.qti.hardware.display.composer-service这个hw services的行为空指针导致syetemserver无法正常启动，找显示驱动同事看下
01-01 00:03:06.802  2432  2432 D SystemServerTiming: StartDisplayManager
01-01 00:03:06.802  2432  2432 I SystemServiceManager: Starting com.android.server.display.DisplayManagerService
01-01 00:03:07.324  2440  2440 F libc    : Fatal signal 11 (SIGSEGV), code 1 (SEGV_MAPERR), fault addr 0x0 in tid 2440 (vendor.qti.hard), pid 2440 (vendor.qti.hard)
01-01 00:03:08.136   607   607 I logd    : logdr: UID=1000 GID=1003 PID=2524 n tail=0 logMask=8 pid=2440 start=0ns deadline=0ns
01-01 00:03:08.137   607   607 I logd    : logdr: UID=1000 GID=1003 PID=2524 n tail=0 logMask=1 pid=2440 start=0ns deadline=0ns
01-01 00:03:07.402  2524  2524 F DEBUG   : *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***
01-01 00:03:07.402  2524  2524 F DEBUG   : Build fingerprint: 'qti/kalama/kalama:13/TKQ1.230929.001/eng.lens.20241122.163401:userdebug/test-keys'
01-01 00:03:07.402  2524  2524 F DEBUG   : Revision: '0'
01-01 00:03:07.402  2524  2524 F DEBUG   : ABI: 'arm64'
01-01 00:03:07.402  2524  2524 F DEBUG   : Timestamp: 1970-01-01 00:03:07.344259580+0000
01-01 00:03:07.402  2524  2524 F DEBUG   : Process uptime: 0s
01-01 00:03:07.402  2524  2524 F DEBUG   : Cmdline: /vendor/bin/hw/vendor.qti.hardware.display.composer-service
01-01 00:03:07.402  2524  2524 F DEBUG   : pid: 2440, tid: 2440, name: vendor.qti.hard  >>> /vendor/bin/hw/vendor.qti.hardware.display.composer-service <<<
01-01 00:03:07.402  2524  2524 F DEBUG   : uid: 1000
```

## GPIO debug
[sm8550-pinctrl](sm8550-pinctrl.md)  
[sm8550-gpio](sm8550-gpio.md)  
[sm8550-prop](sm8550-prop.md)  
[sm8550-bt](sm8550-bt.md)  
```c
c42d000.qcom,spmi:qcom,pm8550@1:pinctrl@8800
c42d000.qcom,spmi:qcom,pm8550b@7:pinctrl@8800
c42d000.qcom,spmi:qcom,pm8550ve_f@5:pinctrl@8800
c42d000.qcom,spmi:qcom,pm8550vs@2:pinctrl@8800
c42d000.qcom,spmi:qcom,pm8550vs@3:pinctrl@8800
c42d000.qcom,spmi:qcom,pm8550vs@4:pinctrl@8800
c42d000.qcom,spmi:qcom,pm8550vs@6:pinctrl@8800
c42d000.qcom,spmi:qcom,pmk8550@0:pinctrl@b800
f000000.pinctrl
pinctrl-devices
pinctrl-handles
pinctrl-maps
soc:spf_core_platform:lpi_pinctrl@6E80000
```
## Services
```c
/data/sm8550/vendor/LA.VENDOR.13.2.6/LINUX/android/vendor/qcom/proprietary/camx/src/core/camxhwenvironment.cpp
@@ -290,7 +290,7 @@ CamxResult HwEnvironment::Initialize(
         if (TRUE == isCameraPresent)
         {
             CAMX_LOG_ERROR(CamxLogGroupCore, "FATAL ERROR: Raise SigAbort. HwEnvironment initialization failed");
-            OsUtils::RaiseSignalAbort();
+            //OsUtils::RaiseSignalAbort();
         }
     }

/data/sm8550/vendor/LA.VENDOR.13.2.6/LINUX/android/vendor/qcom/proprietary/techpack/artifacts/sensors/kalama/vendor/etc/init/vendor.qsap.sensors.rc
@@ -29,8 +29,8 @@
 # ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 #
 
-service vendor.qsap.sensors /vendor/bin/qsap_sensors
-    class core
-    user system
-    group system wakelock
-    capabilities BLOCK_SUSPEND
+#service vendor.qsap.sensors /vendor/bin/qsap_sensors
+#    class core
+#    user system
+#    group system wakelock
+#    capabilities BLOCK_SUSPEND     
```
## Display
```c
/data/sm8550/vendor/LA.VENDOR.13.2.6/LINUX/android/device/qcom/kalama/init.target.rc  
on property:vendor.display.lcd_density=640

device/qcom/common/rootdir/etc/init.qcom.rc:112:    setprop ro.sf.lcd_density ${vendor.display.lcd_density}
```

```c
adb shell getprop ro.sf.lcd_density
adb shell wm size
adb shell wm density
adb shell wm resize 1920*1080
adb shell wm density 640
adb shell wm density reset
```
## KO
```c
//PC
/data/sm8550/vendor/LA.VENDOR.13.2.6/LINUX/android/out/target/product/kalama/vendor_dlkm/lib/modules

```
```c
//device
/vendor_dlkm/lib/modules
```
### lt9711
### btpower
### cnss2

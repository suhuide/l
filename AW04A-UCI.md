[memo.md](memo.md)   
[AW04A](AW04A.md)    

# UCI Architecture 
<div align="left">
  <img src="files/aw04a/uci-architecture.png" width="1080">
</div>

# Format of Control Packets

<div align="left">
  <img src="files/aw04a/uci-Control-packet.png" width="1080">
</div>

```mermaid
classDiagram
    class MT {
        +0b0001: CMD,Host->UWBS
        +0b0010: RSP,UWBS->Host
        +0b0011: NTF,UWBS->Host
    }

    class PBF {
        +0b0: Complete
        +0b1: Segment
    }

    class GID-OID {
        +0b0000: UCI_CORE_GROUP
        +0b0001: UWB_SESSION_GROUP
        +0b0010: UWB_RANGING_GROUP
    }

    class OID_CORE_0b0000 {        
        +0b000000: CORE_DEVICE_RESET_CMD,MT=1
        +0b000000: CORE_DEVICE_RESET_RSP,MT=2
        +0b000001: CORE_DEVICE_STATUS_NTF
        +0b000010: CORE_GET_DEVICE_INFO_CMD,MT=1
        +0b000010: CORE_GET_DEVICE_INFO_RSP,MT=2
        +0b000011: CORE_GET_CAPS_INFO_CMD,MT=1
        +0b000011: CORE_GET_CAPS_INFO_RSP,MT=2
        +0b000100: CORE_SET_CONFIG_CMD,MT=1
        +0b000100: CORE_SET_CONFIG_RSP,MT=2
        +0b000101: CORE_GET_CONFIG_CMD,MT=1
        +0b000101: CORE_GET_CONFIG_RSP,MT=2
        +0b000111: CORE_GENERIC_ERROR_NTF
    }

    class OID_SESSION_0b0001 {        
        +0b000000: SESSION_INIT_CMD,MT=1
        +0b000000: SESSION_INIT_RSP,MT=2
        +0b000001: SESSION_DEINIT_CMD,MT=1        
        +0b000001: SESSION_DEINIT_RSP,MT=2
        +0b000010: SESSION_STATUS_NTF
        +0b000011: SESSION_SET_APP_CONFIG_CMD,MT=1
        +0b000011: SESSION_SET_APP_CONFIG_RSP,MT=2
        +0b000100: SESSION_GET_APP_CONFIG_CMD,MT=1        
        +0b000100: SESSION_GET_APP_CONFIG_RSP,MT=2
        +0b000101: SESSION_GET_COUNT_CMD,MT=1
        +0b000101: SESSION_GET_COUNT_RSP,MT=2
        +0b000110: SESSION_GET_STATE_CMD,MT=1        
        +0b000110: SESSION_GET_STATE_RSP,MT=2
        +0b000111: SESSION_UPDATE_CONTROLLER_MULTICAST_LIST_CMD,MT=1
        +0b000111: SESSION_UPDATE_CONTROLLER_MULTICAST_LIST_RSP,MT=2
        +0b000111: SESSION_UPDATE_CONTROLLER_MULTICAST_LIST_NTF,MT=3
    }

    class OID_RANGING_0b0010 {        
        +0b000000: RANGE_START_CMD,MT=1
        +0b000000: RANGE_START_RSP,MT=2
        +0b000000: RANGE_DATA_NTF,MT=3
        +0b000001: RANGE_STOP_CMD,MT=1        
        +0b000001: RANGE_STOP_RSP,MT=2
        +0b000011: RANGE_GET_RANGING_COUNT_CMD,MT=1        
        +0b000011: RANGE_GET_RANGING_COUNT_RSP,MT=2
    }
   
    class Payload {
        +PayloadLength
        +Payload,0-255 octets
    }

    class UCI_Packet {
        +MT: Message Type (3 bits)
        +PBF: Packet Boundary Flag (1 bit)
        +GID-OID: Group ID (4 bits),Operate ID (6 bits)
        +Payload: (0-255 octets)
    }
    
    UCI_Packet --> MT
    UCI_Packet --> PBF
    UCI_Packet --> GID-OID
    UCI_Packet --> Payload    
    GID-OID --> OID_CORE_0b0000
    GID-OID --> OID_SESSION_0b0001
    GID-OID --> OID_RANGING_0b0010
```

# CORE_DEVICE_STATUS_NTF
```c
Raw packet: 60 01 00 01 01 
GID: UCI_CORE_GROUP (0x0)
OID: CORE_DEVICE_STATUS_NTF (0x1)
STATUS: DEVICE_STATE_READY
```
# CORE_GET_DEVICE_INFO_CMD
```c
Tx:Raw packet: 20 02 00 01 00 
GID: UCI_CORE_GROUP (0x0)
OID: CORE_GET_DEVICE_INFO_CMD (0x2)
RESERVED: 0x00
```
# CORE_GET_DEVICE_INFO_RSP
```c
aw packet: 40 02 00 14 00 01 10 01 30 01 30 01 10 0A 44 E2 F1 1B 01 20 08 08 05 16 
GID: UCI_CORE_GROUP (0x0)
OID: CORE_GET_DEVICE_INFO_RSP (0x2)
STATUS: STATUS_OK
UCI_VERSION: 1.16
MAC_VERSION: 1.48
PHY_VERSION: 1.48
UCI_TEST_VERSION: 1.16
NRT_SDK_VERSION: 68.226
UCI_CCC_VERSION: 241.27
```
# CORE_SET_CONFIG_CMD
```c
Tx:Raw packet: 20 04 00 0A 03 E9 01 03 E6 01 31 01 01 00 
GID: UCI_CORE_GROUP (0x0)
OID: CORE_SET_CONFIG_CMD (0x4)
NUM_PARAMS: 3
[Param 1]
Unknown/Vendor parameter (0xE9), Value: 03 
[Param 2]
Unknown/Vendor parameter (0xE6), Value: 31 
[Param 3]
Low power mode Enable!!!
```
# CORE_SET_CONFIG_RSP
```c
Raw packet: 40 04 00 01 00 
GID: UCI_CORE_GROUP (0x0)
OID: CORE_SET_CONFIG_RSP (0x4)
STATUS: STATUS_OK
```
# SESSION_INIT_CMD
```c
Tx:Raw packet: 21 00 00 05 10 32 54 76 00 
GID: UWB_SESSION_GROUP (0x1)
OID: SESSION_INIT_CMD (0x0)
SESSION_ID: 76543210
SESSION_TYPE: FIRA RANGING SESSION (0x00)
```
# SESSION_INIT_RSP
```c
Raw packet: 41 00 00 01 00 
GID: UWB_SESSION_GROUP (0x1)
OID: SESSION_INIT_RSP (0x0)
STATUS: STATUS_OK
```
# SESSION_STATUS_NTF
```c
Raw packet: 61 02 00 06 10 32 54 76 00 00 
GID: UWB_SESSION_GROUP (0x1)
OID: SESSION_STATUS_NTF (0x2)
SESSION_ID: 76543210
SESSION_STATE: SESSION_STATE_INIT
REASON_CODE: SESSION_MANAGEMENT_COMMANDS
```
# SESSION_SET_APP_CONFIG_CMD
```c
Tx:Raw packet: 21 03 00 2F 10 32 54 76 0C 00 01 01 11 01 01 1B 01 06 0D 01 01 09 04 C8 00 00 00 
01 01 02 03 01 00 08 02 60 09 06 02 A0 BB 05 01 01 07 02 A1 BB 0D 01 01 
GID: UWB_SESSION_GROUP (0x1)
OID: SESSION_SET_APP_CONFIG_CMD (0x3)
SESSION_ID: 76543210
NUM_PARAMS: 12
[Param 1]
Controller
[Param 2]
Initiator
[Param 3]
Unknown parameter (0x1B), Value: 06 
[Param 4]
AoA Enabled (default)
[Param 5]
Ranging Interval: 200 ms
[Param 6]
DS-TWR with Deferred Mode (default)
[Param 7]
Unicast
[Param 8]
Slot Duration: 2400 RSTU
[Param 9]
Device MAC: A0BB (Short)
[Param 10]
Number of Controlees: 1
[Param 11]
Destination MAC: A1BB
[Param 12]
AoA Enabled (default)
```
# SESSION_SET_APP_CONFIG_RSP
```c
Raw packet: 41 03 00 02 00 00 
GID: UWB_SESSION_GROUP (0x1)
OID: SESSION_SET_APP_CONFIG_RSP (0x3)
STATUS: STATUS_OK
NUM_FAILED_PARAMS: 0
```
# SESSION_STATUS_NTF
```c
Raw packet: 61 02 00 06 10 32 54 76 03 00 
GID: UWB_SESSION_GROUP (0x1)
OID: SESSION_STATUS_NTF (0x2)
SESSION_ID: 76543210
SESSION_STATE: SESSION_STATE_IDLE
REASON_CODE: SESSION_MANAGEMENT_COMMANDS
```
# RANGE_START_CMD
```c
Tx:Raw packet: 22 00 00 04 10 32 54 76 
GID: UWB_RANGING_GROUP (0x2)
OID: RANGE_START_CMD (0x0)
SESSION_ID: 76543210
```
# RANGE_START_RSP
```c
Raw packet: 42 00 00 01 00 
GID: UWB_RANGING_GROUP (0x2)
OID: RANGE_START_RSP (0x0)
STATUS: STATUS_OK
```
# CORE_DEVICE_STATUS_NTF
```c
Raw packet: 60 01 00 01 02 
GID: UCI_CORE_GROUP (0x0)
OID: CORE_DEVICE_STATUS_NTF (0x1)
STATUS: DEVICE_STATE_ACTIVE
```
# RANGE_DATA_NTF
```c
Raw packet: 62 00 00 47 00 00 00 00 10 32 54 76 00 C8 00 00 00 01 00 00 00 00 00 00 00 00 00 00 
01 A1 BB 21 00 FF FF 00 00 00 00 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
GID: UWB_RANGING_GROUP (0x2)
OID: RANGE_DATA_NTF  (0x0)
SEQUENCE_NUMBER: 0
SESSION_ID: 76543210
RANGE_INTERVAL: 200 ms
RANGE_TYPE: TWR
MAC_ADDRESS_MODE: 0
NUM_PACKAGES_NTF: 1
RANGE_RESULTS:
    [Result 1]
      MAC_ADDRESS: 0xBBA1
      STATUS: 33
      NLOS: 0
      DISTANCE: 65535 cm
      AOA_AZIMUTH: 0
      AOA_AZIMUTH_FOM: 0
      AOA_ELEVATION: 0
      AOA_ELEVATION_FOM: 0
      AOA_DESTINATION_AZIMUTH: 0
      AOA_DESTINATION_AZIMUTH_FOM: 0
      AOA_DESTINATION_ELEVATION: 0
      AOA_DESTINATION_ELEVATION_FOM: 0
      SLOT_INDEX: 2

```